#!/usr/bin/env ruby
#
# = NAME
# juli    - Personal outline processor and wiki
#
# = SYNOPSIS
# juli [options] [files]
#
# = DESCRIPTION
# see doc/juli.txt for more detail.

$LOAD_PATH.insert(0, File.join(File.dirname(__FILE__), '../lib'))

require 'erb'
require 'fileutils'
require 'optparse'
require 'juli/command'


#------------------------------------------------------------------
# Global variable
#------------------------------------------------------------------
Version       = Juli::VERSION


#------------------------------------------------------------------
# Subroutine Part
#------------------------------------------------------------------


#------------------------------------------------------------------
# Main
#------------------------------------------------------------------
  include Juli::Util
  include Juli::Command

  # default option values
  OPTS    = {
    :g=>'html',
    :o=>'../html/',
    :t=>'default',
    :e=>'.shtml'
  }
  command = 'gen'

  # parse common & default options
  parser = OptionParser.new(usage)

  subparsers = Hash.new{|h,k|
    $stderr.puts "no such juli command: #{k}"
    exit 1
  }
  s = subparsers['gen'] = OptionParser.new
  s.on('-g generator',  visitor_list) {|v| OPTS[:g]  = v}
  s.on('-f')                          {|v| OPTS[:f]  = true}

  s = subparsers['init'] = OptionParser.new
  s.on('-o output_top') {|v| OPTS[:o]  = v}
  s.on('-t template')   {|v| OPTS[:t]  = v}

  parser.order!(ARGV)

  # check command
  command = ARGV.shift if !ARGV.empty?

  # parse command options
  subparsers[command].parse!(ARGV) if !ARGV.empty?

  Juli::Command::run(command, OPTS)
